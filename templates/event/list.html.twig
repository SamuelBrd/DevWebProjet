{% extends 'base.html.twig' %}

{% block title %}{% trans %} Events list {% endtrans %}{% endblock %}

{% block body %}
    <ul class="nav navbar-nav navbar-left">
        <li>
            {# Bouton de filtre #}

            <div>
                <a href="{{ path('allevent.list') }}">{% trans %} Show all events {% endtrans %} </a>     
            </div>
            <div>
                <a href="{{ path('event.list') }}">{% trans %} Show recent events {% endtrans %} </a>     
            </div>
            <br>
            <b>

                {# Bouton de recherche avancée #}

                <button>
                    <div>
                        <a href="{{ path('search_event') }}">{% trans %} Advanced search {% endtrans %} </a>     
                    </div>
                </button>
            </b>
        </li>
    </ul>

    {# Seul l'administrateur peut voir et créer un événement #}

    {% if is_granted('ROLE_ADMIN') %}
        <ul class="nav navbar-nav navbar-right">
            <li>
                <div>
                    <b>
                        <a class="navbar-brand" href="{{ path('event.create') }}">{% trans %} Create an event {% endtrans %}</a>
                    </b>     
                </div>
            </li>
        </ul>
    {% endif %}
    
    <table class="table text-center">
        <br><br><br><br><br>
        <tr>
            <th class="active text-center">{% trans %} Name {% endtrans %}</th>
            <th class="active text-center"> Type </th>
            <th class="active text-center"> Date </th>
            <th class="active text-center">{% trans %} Duration (days) {% endtrans %}</th>
            <th class="active text-center">{% trans %} Consult {% endtrans %}</th>

            {# Seul un administrateur peut éditer et supprimer un événement #}

            {% if is_granted('ROLE_ADMIN') %}
                <th class="active text-center">{% trans %} Edit {% endtrans %}</th>
                <th class="active text-center">{% trans %} Delete {% endtrans %}</th>
            {% endif %}
        </tr>

        {% for evenement in event %}

            {# Les utilisateur membre ne voit que les événeents de leur communauté #}

            {% if is_granted('ROLE_USER') %}
                {% if app.user.getCommuName()  ==  evenement.getTypeEvent() %}
                    <tr>
                        <td>{{ evenement.getNameEvent() }}</td>
                        <td>{{ evenement.getTypeEvent() }}</td>
                        <td>{{ evenement.getDateEvent() | date('d-m-Y') }}</td>
                        <td>{{ evenement.getDureeEvent() }}</td>
                        <td> <a href="event/{{evenement.getId()}}/showEvent"> <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> </a> </td>

                        {# Seul un administrateur de la communauté peut éditer ou supprimer l'événement #}

                        {% if is_granted('ROLE_ADMIN') %}
                            <td> <a href="event/{{evenement.getId()}}/edit"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> </a> </td>
                            <td> <a href="event/{{evenement.getId()}}/delete"> <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> </a> </td>
                        {% endif %}
                    </tr>
                {% endif %}
            {% else %}

                {# Affiche tous les événements existant lorsque l'utilisateur est anonyme #}

                <tr>
                    <td>{{ evenement.getNameEvent() }}</td>
                    <td>{{ evenement.getTypeEvent() }}</td>
                    <td>{{ evenement.getDateEvent() | date('d-m-Y') }}</td>
                    <td>{{ evenement.getDureeEvent() }}</td>
                    <td> <a href="event/{{evenement.getId()}}/showEvent"> <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> </a> </td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
{% endblock %}